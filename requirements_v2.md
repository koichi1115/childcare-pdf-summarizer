# 要件定義書 v2.0 - PDF・画像対応拡張と設定修正

## プロジェクト概要

既存のPDF要約ツールに対して、iPhoneカメラ撮影画像対応と設定サンプルの修正を実施する。

## 改修要件

### 1. 設定サンプルの修正

**現状の課題**
- `Config.gs`、`SetupHelper.gs`、`TitleTest.gs`内のサンプル設定に特定の保育園名が記載されている
- 汎用性を損なう具体的な施設名が含まれている

**要件**
- 全ての設定サンプルを汎用的な表記に変更
- 「○○保育園」「○○音楽教室」などの表記に統一
- プライバシーに配慮した汎用的なサンプルデータに修正

**対象ファイル**
- `src/Config.gs`
- `src/SetupHelper.gs`
- `src/TestRunner.gs`
- `src/TitleTest.gs`
- `README.md`（必要に応じて）

### 2. iPhone画像対応機能の追加

**現状の課題**
- PDFファイルのみ対応
- iPhoneカメラで撮影したお便りの画像が処理できない
- 画像ファイル（JPEG、PNG）の取り扱いが未対応

**要件**
- JPEG、PNG形式の画像ファイルに対応
- PDFと同様の処理フローで画像を分析
- Gemini 2.0 Flash APIの画像解析機能を活用
- 既存のPDF処理機能はそのまま維持

**技術仕様**
- 対応画像形式：JPEG、PNG
- ファイルサイズ制限：Gemini APIの制限に準拠
- 画像のBase64エンコード処理
- MIME type自動判定機能

**処理フロー**
1. Google DriveフォルダからPDF・画像ファイルを取得
2. ファイル形式を判定（PDF/JPEG/PNG）
3. 適切なMIME typeでGemini APIに送信
4. 既存と同様の要約・タスク抽出処理
5. Googleカレンダー・タスクへの登録

## 技術要件

### 使用技術（変更なし）
- Google Apps Script (GAS)
- Gemini 2.0 Flash API（画像解析機能を活用）
- Google Drive API
- Google Calendar API
- Google Tasks API

### 新規対応MIME Type
- `image/jpeg`
- `image/png`
- `application/pdf`（既存）

### セキュリティ要件
- 画像ファイルの個人情報保護
- APIキー管理（変更なし）
- 画像データの一時的な処理のみ

### 品質要件
- 既存のPDF処理機能に影響を与えない
- 画像処理のエラーハンドリング強化
- 画像品質による認識精度の考慮

## 実装方針

### Phase 1: 設定サンプル修正（0.5日）
1. 特定施設名の洗い出し
2. 汎用的な表記への置換
3. テスト実行での動作確認

### Phase 2: 画像対応機能実装（1-2日）
1. ファイル形式判定ロジックの追加
2. 画像のBase64エンコード処理
3. MIME type自動設定機能
4. 既存処理との統合

### Phase 3: テスト・品質確認（1日）
1. PDF処理の回帰テスト
2. 画像処理の動作テスト
3. エラーハンドリングの確認

## 成果物

1. **修正されたGASスクリプト**
   - 汎用的な設定サンプル
   - 画像対応機能

2. **更新されたドキュメント**
   - README.md（画像対応の説明追加）
   - TEST.md（画像テスト手順追加）

3. **テスト結果**
   - PDF処理の回帰テスト結果
   - 画像処理の動作確認結果

## 検収基準

### 1. 設定サンプル修正
- [ ] 特定の施設名が全て汎用表記に変更されている
- [ ] 既存機能に影響がない
- [ ] テストが正常に動作する

### 2. 画像対応機能
- [ ] JPEG、PNG画像が正常に処理される
- [ ] 画像からの要約・タスク抽出が動作する
- [ ] PDFと同等の品質で処理される
- [ ] 既存のPDF処理機能に影響がない
- [ ] エラーハンドリングが適切に動作する

### 3. 品質保証
- [ ] 全てのテストが成功する
- [ ] ドキュメントが更新されている
- [ ] パフォーマンスが許容範囲内

## リスク

- **画像認識精度**: カメラ撮影の画像品質によって認識精度が変動する可能性
- **APIレート制限**: 画像処理によるAPI使用量増加
- **ファイルサイズ制限**: 大きな画像ファイルの処理制限

## 追加検討事項

- 画像の前処理（回転、明度調整）の必要性
- OCR精度向上のための推奨撮影方法の案内
- 処理失敗時の代替手段の提供