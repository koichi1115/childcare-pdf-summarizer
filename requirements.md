# 要件定義書 - 学校・習い事PDF要約ツール改修プロジェクト

## プロジェクト概要

既存の保育園・ピアノ教室PDF要約ツールを改修し、保育園・幼稚園から中学校までの学校・習い事全般で汎用的に利用できるツールに拡張する。セキュリティ強化とタスク管理機能の完成も併せて実施する。

## 改修要件

### 1. 汎用化対応 - 学校・習い事への拡張

**現状の課題**
- 保育園・ピアノ教室に特化した実装
- 他の学校・習い事では利用できない

**要件**
- 学校・習い事全般に対応できる汎用的な仕組みに変更
- 学校情報：子供1人につき1つの学校
- 習い事情報：子供1人につき複数の習い事に対応
- 発行元の自動判別機能を拡張

**対応範囲**
- 保育園・幼稚園
- 小学校
- 中学校
- ピアノ、水泳、サッカー、塾等の習い事

### 2. セキュリティ強化 - 個人情報の外部化

**現状の課題**
- 子供の個人情報がGSファイル内にハードコーディングされている
- プライベートリポジトリでの管理が必要で、公開できない状態

**要件**
- 個人情報をスクリプトプロパティまたは設定ファイルに移動
- コード内から個人情報を完全に除去
- パブリックリポジトリでの公開が可能な状態にする

**対象情報**
- 子供の氏名、生年月日
- 学校情報（学校名、所在地、クラス等）
- 習い事情報（教室名、所在地、レッスン時間等）

### 3. Googleタスク自動登録機能の完成

**現状の課題**
- カレンダー登録は完成しているが、Googleタスク登録部分が未実装
- 子供に関連するタスクの抽出ロジックが不完全

**要件**
- PDF要約結果から子供に関連するタスクを正確に抽出
- 抽出されたタスクをGoogleタスクに自動登録
- 最新のGemini API（Gemini 2.0 Flash）のMCP機能を活用してカレンダー・タスク登録を簡素化
- タスクの期限設定機能
- 重複タスクの防止機能

**技術アップグレード**
- Gemini 1.5 Flash → Gemini 2.0 Flash への移行
- MCP (Model Context Protocol) を活用したGoogle サービス連携
- より効率的なカレンダー・タスク登録実装

### 4. 開発日誌管理システムの構築

**要件**
- プロジェクト内に開発日誌専用フォルダを作成
- 日次での開発記録をMarkdown形式で管理
- 開発者の正直な感想・課題・学びを記録

**フォルダ構造**
```
diary/
├── 2025-06-22.md
├── 2025-06-23.md
└── ...
```

## 技術要件

### 使用技術
- Google Apps Script (GAS)
- **Gemini 2.0 Flash API** (MCP対応)
- Google Calendar API (MCP経由)
- Google Tasks API (MCP経由)
- Google Drive API

### API バージョン
- **Gemini API**: Gemini 2.0 Flash
- **MCP**: Model Context Protocol 対応
- Google Calendar API: v3
- Google Tasks API: v1

### セキュリティ要件
- APIキーはスクリプトプロパティで管理
- 個人情報の外部化
- ログ出力時の個人情報マスキング

### 品質要件
- エラーハンドリングの強化
- ログ出力の改善
- コード可読性の向上
- 既存機能の品質維持

## データ構造設計

### 子供情報
```json
{
  "children": [
    {
      "name": "子供の氏名",
      "birthDate": "生年月日",
      "school": {
        "name": "学校名",
        "type": "保育園|幼稚園|小学校|中学校",
        "address": "所在地",
        "grade": "学年",
        "class": "クラス"
      },
      "activities": [
        {
          "name": "習い事名",
          "address": "所在地", 
          "schedule": "スケジュール情報",
          "notes": "その他情報"
        }
      ]
    }
  ]
}
```

## 成果物

1. 改修されたGASスクリプト
2. 設定手順書（README更新）
3. 開発日誌ファイル群
4. テスト結果報告書

## スケジュール

- Phase 1: 個人情報外部化・汎用化対応（2日）
- Phase 2: Gemini 2.0 Flash + MCP対応・タスク登録機能完成（2-3日）
- Phase 3: 開発日誌システム構築（1日）
- Phase 4: テスト・最終調整（1日）

## リスク

- Gemini 2.0 Flash + MCP の学習コスト
- 汎用化に伴う複雑性の増加
- 個人情報抽出ロジックの複雑性
- API制限・認証周りのトラブル

## 検収基準

1. **セキュリティ**
   - 個人情報がコードから完全に除去されている
   - パブリックリポジトリで公開可能な状態

2. **汎用化**
   - 保育園・幼稚園・小学校・中学校に対応できる
   - 複数の習い事登録に対応している
   - 発行元の自動判別が正常に動作する

3. **機能完成度**
   - PDF要約からタスクが正確に抽出・登録される
   - **既存の要約機能が現状と変わらず正しく動作する**
   - カレンダー登録機能が正常に動作する
   - Gemini 2.0 Flash + MCP による効率的な処理

4. **品質**
   - 開発日誌が適切に記録されている
   - README等のドキュメントが更新されている
   - エラーハンドリングが強化されている